<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Template Details â€“ WebHub</title>

  <!-- Tailwind + Required Styles -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>

  <style>
    /* Floating theme toggle */
    .floating-btn {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      z-index: 9999;
      cursor: pointer;
      user-select: none;
    }

    /* Carousel container */
    .carousel {
      position: relative;
      overflow: hidden;
      border-radius: 0.75rem; /* rounded-lg */
      box-shadow: 0 10px 15px rgba(59, 130, 246, 0.2);
    }

    /* Carousel inner wrapper */
    .carousel-inner {
      display: flex;
      transition: transform 0.4s ease-in-out;
      will-change: transform;
    }

    /* Carousel item */
    .carousel-item {
      min-width: 100%;
      user-select: none;
    }

    /* Carousel buttons */
    .carousel-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(59, 130, 246, 0.8);
      color: white;
      border: none;
      border-radius: 9999px;
      width: 2.5rem;
      height: 2.5rem;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: background 0.25s;
      z-index: 10;
    }
    .carousel-btn:hover,
    .carousel-btn:focus {
      background: rgba(59, 130, 246, 1);
      outline: none;
    }
    .carousel-btn.prev {
      left: 1rem;
    }
    .carousel-btn.next {
      right: 1rem;
    }
  </style>
</head>

<body class="bg-white text-gray-900 dark:bg-gray-900 dark:text-white transition-colors duration-300 relative font-sans">

  <!-- Navbar placeholder -->
  <!-- Navbar -->
  <div id="navbar"></div>
  <script src="assets/js/getNavbar.js"></script>
  <script>
    // Call the function and insert into DOM
    document.getElementById("navbar").innerHTML = getNavbarHTML();
  </script>
  <script src="assets/js/navbar.js"></script>

  <div class="pt-24"></div>

  <br>
  <main class="max-w-6xl mx-auto px-4 py-12 space-y-12">

    <section aria-live="polite" aria-atomic="true">
      <div id="templateContainer" class="space-y-10">
        <!-- Content will be inserted here dynamically -->
      </div>
    </section>

  </main>

  <!-- Floating Theme Toggle Button -->
  <button
    id="themeToggleBtn"
    aria-label="Toggle Theme"
    class="floating-btn bg-gradient-to-r from-blue-600 to-cyan-500 dark:from-gray-700 dark:to-gray-800 p-3 rounded-full shadow-xl hover:scale-110 focus:outline-none focus:ring-4 focus:ring-blue-400 transition duration-200"
    type="button"
  >
    <svg
      id="icon-sun"
      xmlns="http://www.w3.org/2000/svg"
      class="h-6 w-6 hidden"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      aria-hidden="true"
      focusable="false"
    >
      <circle cx="12" cy="12" r="5" stroke-width="2" />
      <path
        stroke-linecap="round"
        stroke-width="2"
        d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M16.36 16.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M16.36 7.64l1.42-1.42"
      />
    </svg>
    <svg
      id="icon-moon"
      xmlns="http://www.w3.org/2000/svg"
      class="h-6 w-6 block"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      aria-hidden="true"
      focusable="false"
    >
      <path
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M21 12.79A9 9 0 1111.21 3c.03 0 .06.01.09.01a7 7 0 0010.7 9.78z"
      />
    </svg>
  </button>

   <div id="footer"></div>
  <script src="assets/js/getFooter.js"></script>
  <script>
    // Call the function and insert into DOM
    document.getElementById("footer").innerHTML = getFooterHTML();
  </script>

  <script>
    const folder = new URLSearchParams(location.search).get('id');
    const container = document.getElementById("templateContainer");

    // Theme toggle logic
    const root = document.documentElement;
    const toggleBtn = document.getElementById('themeToggleBtn');
    const iconSun = document.getElementById('icon-sun');
    const iconMoon = document.getElementById('icon-moon');

    function updateThemeIcon() {
      if (root.classList.contains('dark')) {
        iconSun.classList.remove('hidden');
        iconMoon.classList.add('hidden');
      } else {
        iconSun.classList.add('hidden');
        iconMoon.classList.remove('hidden');
      }
    }

    function initTheme() {
      const saved = localStorage.getItem('theme');
      if (saved === 'dark') {
        root.classList.add('dark');
      } else if (saved === 'light') {
        root.classList.remove('dark');
      } else {
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          root.classList.add('dark');
        } else {
          root.classList.remove('dark');
        }
      }
      updateThemeIcon();
    }

    toggleBtn.addEventListener('click', () => {
      const isDark = root.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      updateThemeIcon();
    });

    initTheme();

    if (!folder) {
      container.innerHTML = `<p class="text-red-600 text-center text-xl font-semibold">Invalid template link.</p>`;
      throw new Error("Missing template id");
    }

    // Carousel helper function: create image slider
    function createCarousel(images, altText) {
      if (!images.length) return '';

      // Unique ID for carousel for accessibility
      const carouselId = `carousel-${Math.random().toString(36).substring(2, 9)}`;

      // Structure of carousel in HTML
      return `
      <div class="carousel" aria-label="Image Carousel for template">
        <div class="carousel-inner" id="${carouselId}">
          ${images
            .map(
              (img, idx) => `
            <div class="carousel-item" aria-hidden="${
              idx === 0 ? 'false' : 'true'
            }" role="group" aria-roledescription="slide" aria-label="Slide ${
                idx + 1
              } of ${images.length}">
              <img src="templates/${folder}/${img}" alt="${altText} screenshot ${
                idx + 1
              }" class="w-full object-cover rounded-lg" loading="lazy" />
            </div>`
            )
            .join('')}
        </div>
        <button class="carousel-btn prev" aria-label="Previous Slide" type="button" data-target="#${carouselId}">&#10094;</button>
        <button class="carousel-btn next" aria-label="Next Slide" type="button" data-target="#${carouselId}">&#10095;</button>
      </div>`;
    }

    fetch(`templates/${folder}/metadata.json`)
      .then((res) => {
        if (!res.ok) throw new Error("Failed to fetch metadata");
        return res.json();
      })
      .then((data) => {
        container.innerHTML = `
          <article>
            <header class="mb-10">
              <h1 class="text-4xl font-bold mb-2">${data.name}</h1>
              <p class="text-lg text-gray-700 dark:text-gray-300">${data.description}</p>
            </header>

            <section class="mb-10">
              ${createCarousel(data.images, data.name)}
            </section>

            <section class="space-y-3 mb-10 text-gray-800 dark:text-gray-300">
              <div><strong>Author:</strong> ${data.author}</div>
              <div><strong>Created:</strong> ${data.created}</div>
              <div><strong>License:</strong> ${data.license}</div>
              <div><strong>Tags:</strong>
                ${data.tags
                  .map(
                    (tag) => `
                  <span class="inline-block bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-white px-3 py-1 rounded-full text-sm mr-2">${tag}</span>
                `
                  )
                  .join('')}
              </div>
              <div><strong>Technologies:</strong> ${data.technologies.join(', ')}</div>
              <div>
                <strong>Features:</strong>
                <ul class="list-disc list-inside mt-1">
                  ${data.features.map((feature) => `<li>${feature}</li>`).join('')}
                </ul>
              </div>
              <div>
                <strong>Sections:</strong>
                <ul class="list-inside mt-1">
                  ${data.sections.map((section) => `<li>ðŸ”¹ ${section.title}</li>`).join('')}
                </ul>
              </div>
            </section>

            <section class="flex gap-4">
              <a href="templates/${folder}/${data.liveUrl}" target="_blank" class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700 transition font-semibold shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400" rel="noopener">
                Live Preview
              </a>
              <a href="${data.sourceUrl}" target="_blank" class="bg-gray-700 text-white px-6 py-3 rounded hover:bg-gray-800 transition font-semibold shadow-md focus:outline-none focus:ring-2 focus:ring-gray-700" rel="noopener">
                Source Code
              </a>
            </section>
          </article>
        `;

        // Carousel script (basic slider functionality)
        const carouselElement = container.querySelector('.carousel');
        if (carouselElement) {
          const inner = carouselElement.querySelector('.carousel-inner');
          const slides = Array.from(inner.children);
          let currentIndex = 0;

          function updateSlide(toIndex) {
            if (toIndex < 0) toIndex = slides.length - 1;
            if (toIndex >= slides.length) toIndex = 0;
            currentIndex = toIndex;
            const offset = -toIndex * 100;
            inner.style.transform = `translateX(${offset}%)`;
            slides.forEach((slide, idx) => {
              slide.setAttribute('aria-hidden', idx !== currentIndex);
            });
          }

          carouselElement.querySelector('.carousel-btn.prev').onclick = () => {
            updateSlide(currentIndex - 1);
          };
          carouselElement.querySelector('.carousel-btn.next').onclick = () => {
            updateSlide(currentIndex + 1);
          };

          // Initialize first slide
          updateSlide(0);
        }
      })
      .catch((err) => {
        console.error(err);
        container.innerHTML = `<p class="text-red-600 text-center text-xl font-semibold">Error loading template details.</p>`;
      });
  </script>
</body>
</html>
