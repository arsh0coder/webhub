<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Templates ‚Äì WebHub</title>

  <!-- Tailwind + AOS CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>
  <style>
    .filter-scrollbar::-webkit-scrollbar { display: none; }
    .filter-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .mobile-filter-enter { transform: translateY(100%);}
    .mobile-filter-open {transform: translateY(0);}
    .sticky-sidebar { position: sticky; top: 8rem; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-100">

  <div id="navbar"></div>
  <div class="pt-24"></div>
  
  <section class="text-center py-12 bg-blue-600 text-white">
    <h1 class="text-4xl font-bold mb-2">Explore All Templates</h1>
    <p class="text-lg">Filter and discover website templates from our open-source collection</p>
  </section>

  <!-- Main 2-column Layout -->
  <div class="max-w-7xl mx-auto px-4 py-4 flex gap-6 md:mt-8 mt-2 relative">

    <!-- Sidebar Filters for Desktop (hidden on small screens) -->
    <aside
      id="sidebarFilters"
      class="hidden md:flex flex-col gap-4 w-64 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 p-4 rounded-xl filter-scrollbar sticky-sidebar h-fit overflow-y-auto"
      style="min-width: 240px;"
    >
      <div id="tagFilters" class="flex flex-wrap gap-2 mb-4"></div>
      <select id="authorFilter" class="mb-2 px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800" >
        <option value="">All Authors</option>
      </select>
      <select id="licenseFilter" class="mb-2 px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800" >
        <option value="">All Licenses</option>
      </select>
      <select id="categoryFilter" class="mb-2 px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800" >
        <option value="">All Categories</option>
      </select>
      <select id="difficultyFilter" class="mb-2 px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800" >
        <option value="">All Difficulties</option>
      </select>
      <input type="text" id="searchInput" placeholder="Search templates..." class="mb-2 px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800" />
      <button id="applyFiltersBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition font-semibold shadow">
        Apply Filters
      </button>
    </aside>

    <!-- Projects grid -->
    <main class="flex-1">
      <div id="projectsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"></div>
      <div class="flex justify-center mt-8">
        <button id="loadMoreBtn" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 shadow transition">
          Load More
        </button>
      </div>
    </main>
  </div>

  <!-- Mobile: bottom navbar with filter button -->
  <div class="fixed bottom-0 left-0 right-0 z-40 flex justify-center items-center md:hidden bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 py-3 shadow-lg">
    <button
      id="mobileFilterFAB"
      class="flex items-center gap-2 rounded-full bg-blue-600 text-white px-6 py-2 font-semibold text-lg shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-400 transition"
      aria-label="Show Filters"
    >
      üîç Filter
    </button>
  </div>

  <!-- Mobile: Filter Panel Modal -->
  <div
    id="mobileFilterDrawer"
    class="fixed z-50 left-0 right-0 bottom-0 bg-white dark:bg-gray-900 rounded-t-2xl border-t border-gray-200 dark:border-gray-800 shadow-2xl p-4 transition duration-300 transform mobile-filter-enter"
    style="display:none;"
  >
    <div class="flex items-center justify-between mb-1">
      <span class="font-semibold text-lg">Filters</span>
      <button id="closeMobileFilterDrawer" class="text-2xl p-2 text-gray-500 hover:text-gray-800 focus:outline-none">√ó</button>
    </div>
    <div id="mobileTagFilters" class="flex flex-wrap gap-2 mb-2"></div>
    <select id="mobileAuthorFilter" class="mb-2 w-full px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
      <option value="">All Authors</option>
    </select>
    <select id="mobileLicenseFilter" class="mb-2 w-full px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
      <option value="">All Licenses</option>
    </select>
    <select id="mobileCategoryFilter" class="mb-2 w-full px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
      <option value="">All Categories</option>
    </select>
    <select id="mobileDifficultyFilter" class="mb-2 w-full px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
      <option value="">All Difficulties</option>
    </select>
    <input type="text" id="mobileSearchInput" placeholder="Search templates..." class="mb-2 px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 w-full" />
    <button id="mobileApplyFiltersBtn" class="mt-3 w-full bg-blue-600 text-white px-4 py-3 rounded-md text-lg font-bold hover:bg-blue-700 shadow transition">
      Apply Filter
    </button>
  </div>

  <!-- Floating Theme toggle button -->
  <button
    id="themeToggle"
    class="fixed bottom-6 right-6 z-50 p-4 rounded-full shadow-lg bg-gradient-to-r from-blue-600 to-cyan-500 dark:from-gray-700 dark:to-gray-800 text-white hover:scale-110 focus:outline-none focus:ring-4 focus:ring-blue-400 transition"
    aria-label="Toggle Theme"
  >
    <svg id="icon-moon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 block" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
      <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M21 12.79A9 9 0 1111.21 3c.03 0 .06.01.09.01a7 7 0 0010.7 9.78z" />
    </svg>
    <svg id="icon-sun" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
      <circle cx="12" cy="12" r="5" stroke-width="2" />
      <path stroke-linecap="round" stroke-width="2" d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M16.36 16.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M16.36 7.64l1.42-1.42" />
    </svg>
  </button>

  <div id="footer"></div>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="../assets/js/nav_footer_loader.js"></script>
  
  <script>
    AOS.init();

    // DOM element references needed for rendering
    const grid = document.getElementById("projectsGrid");
    const loadMoreBtn = document.getElementById("loadMoreBtn");

    let templates = [];
    let activeTags = [];
    let mobileActiveTags = [];
    let currentPage = 1;
    const pageSize = 6;

    // Populate filters and handle events
    fetch("../templates/templates.json")
      .then(res => res.json())
      .then(data => {
        templates = data.templates;
        const uniqueTags = [...new Set(templates.flatMap(t => t.tags))];
        const uniqueAuthors = [...new Set(templates.map(t => t.author))];
        const uniqueLicenses = [...new Set(templates.map(t => t.license))];
        const uniqueCategories = [...new Set(templates.map(t => t.category))];
        const uniqueDifficulties = [...new Set(templates.map(t => t.difficulty))];

        // Populate desktop tag buttons
        const tagFilters = document.getElementById("tagFilters");
        uniqueTags.forEach(tag => {
          const btn = document.createElement("button");
          btn.className = `tag-btn bg-blue-100 text-blue-700 dark:bg-blue-800 dark:text-blue-100 px-4 py-1 rounded-full text-sm hover:bg-blue-200 dark:hover:bg-blue-700 transition`;
          btn.dataset.tag = tag;
          btn.innerText = tag;
          tagFilters.appendChild(btn);
        });

        // Populate dropdowns (desktop and mobile)
        const authorFilter = document.getElementById("authorFilter");
        const licenseFilter = document.getElementById("licenseFilter");
        const categoryFilter = document.getElementById("categoryFilter");
        const difficultyFilter = document.getElementById("difficultyFilter");
        const mobileAuthorFilter = document.getElementById("mobileAuthorFilter");
        const mobileLicenseFilter = document.getElementById("mobileLicenseFilter");
        const mobileCategoryFilter = document.getElementById("mobileCategoryFilter");
        const mobileDifficultyFilter = document.getElementById("mobileDifficultyFilter");

        uniqueAuthors.forEach(author => {
          const opt = document.createElement("option");
          opt.value = author;
          opt.innerText = author;
          authorFilter.appendChild(opt);
          mobileAuthorFilter.appendChild(opt.cloneNode(true));
        });
        uniqueLicenses.forEach(license => {
          const opt = document.createElement("option");
          opt.value = license;
          opt.innerText = license;
          licenseFilter.appendChild(opt);
          mobileLicenseFilter.appendChild(opt.cloneNode(true));
        });
        uniqueCategories.forEach(category => {
          const opt = document.createElement("option");
          opt.value = category;
          opt.innerText = category;
          categoryFilter.appendChild(opt);
          mobileCategoryFilter.appendChild(opt.cloneNode(true));
        });
        uniqueDifficulties.forEach(diff => {
          const opt = document.createElement("option");
          opt.value = diff;
          opt.innerText = diff;
          difficultyFilter.appendChild(opt);
          mobileDifficultyFilter.appendChild(opt.cloneNode(true));
        });

        // Mobile tag buttons
        const mobileTagFilters = document.getElementById("mobileTagFilters");
        function updateMobileTagFilterUI() {
          mobileTagFilters.innerHTML = "";
          uniqueTags.forEach(tag => {
            const btn = document.createElement("button");
            btn.className = 'tag-btn bg-blue-100 text-blue-700 dark:bg-blue-800 dark:text-blue-100 px-4 py-1 rounded-full text-sm hover:bg-blue-200 dark:hover:bg-blue-700 transition ' +
              (mobileActiveTags.includes(tag) ? 'bg-blue-600 text-white dark:bg-blue-400 dark:text-gray-900' : '');
            btn.dataset.tag = tag;
            btn.innerText = tag;
            mobileTagFilters.appendChild(btn);
          });
        }
        updateMobileTagFilterUI();

        // Tag filter toggle handlers
        tagFilters.addEventListener("click", e => {
          if (e.target.classList.contains("tag-btn")) {
            const tag = e.target.dataset.tag;
            e.target.classList.toggle("bg-blue-600");
            e.target.classList.toggle("text-white");
            if (activeTags.includes(tag)) {
              activeTags = activeTags.filter(t => t !== tag);
            } else {
              activeTags.push(tag);
            }
          }
        });
        mobileTagFilters.addEventListener("click", e => {
          if (e.target.classList.contains("tag-btn")) {
            const tag = e.target.dataset.tag;
            if (mobileActiveTags.includes(tag)) {
              mobileActiveTags = mobileActiveTags.filter(t => t !== tag);
            } else {
              mobileActiveTags.push(tag);
            }
            updateMobileTagFilterUI();
          }
        });

        // Sync mobile to desktop inputs
        function syncMobileFiltersToDesktop() {
          authorFilter.value = mobileAuthorFilter.value;
          licenseFilter.value = mobileLicenseFilter.value;
          categoryFilter.value = mobileCategoryFilter.value;
          difficultyFilter.value = mobileDifficultyFilter.value;
          document.getElementById("searchInput").value = document.getElementById("mobileSearchInput").value;
          activeTags = mobileActiveTags.slice();
        }

        // Sync desktop to mobile inputs
        function syncDesktopFiltersToMobile() {
          mobileAuthorFilter.value = authorFilter.value;
          mobileLicenseFilter.value = licenseFilter.value;
          mobileCategoryFilter.value = categoryFilter.value;
          mobileDifficultyFilter.value = difficultyFilter.value;
          document.getElementById("mobileSearchInput").value = document.getElementById("searchInput").value;
          mobileActiveTags = activeTags.slice();
          updateMobileTagFilterUI();
        }

        // Filter and render functions
        function getPageTemplates(data) {
          const selectedAuthor = authorFilter.value;
          const selectedLicense = licenseFilter.value;
          const selectedCategory = categoryFilter.value;
          const selectedDifficulty = difficultyFilter.value;
          const searchQuery = document.getElementById("searchInput").value.trim().toLowerCase();

          return data.filter(template => {
            const tagMatch = activeTags.length === 0 || activeTags.every(tag => template.tags.includes(tag));
            const authorMatch = !selectedAuthor || template.author === selectedAuthor;
            const licenseMatch = !selectedLicense || template.license === selectedLicense;
            const categoryMatch = !selectedCategory || template.category === selectedCategory;
            const difficultyMatch = !selectedDifficulty || template.difficulty === selectedDifficulty;
            const searchMatch = template.name.toLowerCase().includes(searchQuery) || template.description.toLowerCase().includes(searchQuery);
            return tagMatch && authorMatch && licenseMatch && categoryMatch && difficultyMatch && searchMatch;
          }).slice(0, currentPage * pageSize);
        }

        function renderTemplates(list, append = false) {
          if (!append) grid.innerHTML = "";
          if (list.length === 0) {
            grid.innerHTML = `<p class="text-center col-span-full text-gray-500">No templates found.</p>`;
            return;
          }
          list.forEach(t => {
            const card = document.createElement("div");
            card.className = "bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition overflow-hidden";
            card.innerHTML = `
              <img src="${t.previewImage}" alt="${t.name}" class="w-full h-48 object-cover rounded-t-lg" />
              <div class="p-4 flex flex-col h-full">
                <div class="flex items-center justify-between mb-2">
                  <h3 class="text-xl font-bold">${t.name}</h3>
                  ${t.featured ? '<span class="bg-yellow-400 text-xs px-2 py-1 rounded text-black">Featured</span>' : ''}
                </div>
                <p class="text-gray-600 dark:text-gray-300 text-sm mb-3">${t.description}</p>
                <div class="flex flex-wrap gap-1 text-xs mb-3">
                  ${t.tags.map(tag => `<span class="bg-blue-100 text-blue-700 dark:bg-blue-700 dark:text-white px-2 py-1 rounded">${tag}</span>`).join("")}
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400 mb-3">
                  By <strong>${t.author}</strong> ¬∑ ${t.created} ¬∑ ${t.category} ¬∑ ${t.difficulty}
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400 mb-3">
                  Tech: ${t.techStack.join(", ")}
                </div>
                <div class="flex gap-3">
                  <a href="template-details.html?id=${t.folder}" target="_blank"
                    class="flex-1 bg-gradient-to-r from-blue-600 to-blue-500 text-white text-center px-4 py-2 rounded-lg shadow-md hover:from-blue-700 hover:to-blue-600 transition-all duration-200">
                    üöÄ Explore
                  </a>
                  <a href="${t.sourceUrl}" target="_blank"
                    class="flex-1 bg-gradient-to-r from-gray-700 to-gray-600 text-white text-center px-4 py-2 rounded-lg shadow-md hover:from-gray-800 hover:to-gray-700 transition-all duration-200">
                    üì¶ Source
                  </a>
                </div>
              </div>
            `;
            grid.appendChild(card);
          });

          // Show/hide Load More button
          if ((currentPage * pageSize) >= getPageTemplates(templates).length) {
            loadMoreBtn.classList.add("hidden");
          } else {
            loadMoreBtn.classList.remove("hidden");
          }
        }

        // Event Listeners for Apply Filters and Load More
        document.getElementById("applyFiltersBtn").addEventListener("click", () => {
          currentPage = 1;
          renderTemplates(getPageTemplates(templates));
          syncDesktopFiltersToMobile();
        });
        document.getElementById("mobileApplyFiltersBtn").addEventListener("click", () => {
          syncMobileFiltersToDesktop();
          currentPage = 1;
          renderTemplates(getPageTemplates(templates));
          document.getElementById("mobileFilterDrawer").classList.remove("mobile-filter-open");
          setTimeout(() => { document.getElementById("mobileFilterDrawer").style.display = "none"; }, 250);
        });
        loadMoreBtn.addEventListener("click", () => {
          currentPage++;
          renderTemplates(getPageTemplates(templates), true);
        });

        // Initial render
        renderTemplates(getPageTemplates(templates));
      });

    // Mobile filter drawer toggle
    const mobileFilterFAB = document.getElementById("mobileFilterFAB");
    const mobileFilterDrawer = document.getElementById("mobileFilterDrawer");
    const closeMobileFilterDrawer = document.getElementById("closeMobileFilterDrawer");
    mobileFilterFAB.addEventListener("click", () => {
      mobileFilterDrawer.style.display = "block";
      setTimeout(() => {
        mobileFilterDrawer.classList.add("mobile-filter-open");
        mobileFilterDrawer.classList.remove("mobile-filter-enter");
      }, 10);
    });
    closeMobileFilterDrawer.addEventListener("click", () => {
      mobileFilterDrawer.classList.remove("mobile-filter-open");
      setTimeout(() => { mobileFilterDrawer.style.display = "none"; }, 250);
    });

    // --- Theme toggle button behavior ---
    const themeToggle = document.getElementById("themeToggle");
    const iconSun = document.getElementById("icon-sun");
    const iconMoon = document.getElementById("icon-moon");
    const root = document.documentElement;

    function updateThemeIcon() {
      if (root.classList.contains("dark")) {
        iconSun.classList.remove("hidden");
        iconMoon.classList.add("hidden");
      } else {
        iconSun.classList.add("hidden");
        iconMoon.classList.remove("hidden");
      }
    }

    themeToggle.addEventListener("click", () => {
      const isDark = root.classList.toggle("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      updateThemeIcon();
    });

    if (localStorage.getItem("theme") === "dark") root.classList.add("dark");
    updateThemeIcon();

  </script>
</body>
</html>
